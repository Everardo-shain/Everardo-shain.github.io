{{ $sectionID := replace (lower .section.name) " " "-" }}
{{ if .section.id }}
  {{ $sectionID = .section.id }}
{{ end }}

{{/* CSS FIX FOR FIXED COLUMN WIDTH */}}
<style>
  .education-section .taken-courses table {
    table-layout: fixed;
    width: 100%;
  }

  .education-section .taken-courses .course-name-header {
    width: 75%; /* Adjust percentage as needed */
  }

  /* Style for the disabled pagination buttons */
  .education-section .pagination .page-item.disabled .page-link {
    pointer-events: none;
    color: #6c757d;
    background-color: transparent;
  }
</style>

<div class="container-fluid anchor pb-5 education-section">
  {{ if not (.section.hideTitle) }}
    <h1 class="text-center">
      <span id="{{ $sectionID }}"></span>{{ .section.name }}
    </h1>
  {{ else }}
    <h1 class="text-center" style="display: none">
      <span id="{{ $sectionID }}"></span>{{ .section.name }}
    </h1>
  {{ end }}
  <div class="container">
    <table class="education-info-table">
      <tbody>
        {{ $count := len .degrees }}
        {{ range $degreeIndex, $degree := .degrees }}
          <tr>
            <td class="icon">
              {{ if gt $count 1 }}
                <div class="hline"></div>
              {{ end }}
              <div class="icon-holder">
                <i class="fas {{ .icon }}"></i>
              </div>
            </td>
            <td class="line">
              <div></div>
            </td>
            <td class="details">
              <div class="degree-info card">
                {{/* ... Code for degree info, logo, etc. ... */}}
                <div class="row">
                  <div class="col-lg-9 col-md-8">
                    {{ if .institution.url }}
                      <h5><a href="{{ .institution.url }}" title="{{ .institution.name }}" target="_blank" rel="noopener">{{ .institution.name }}</a></h5>
                    {{ else }}
                      <h5>{{ .institution.name }}</h5>
                    {{ end }}
                  </div>
                  <div class="timeframe col-lg-3 col-md-4">{{ .timeframe }}</div>
                </div>
                <h6>{{ .name }}</h6>
                {{ if .grade }}
                  <h6><span class="text-heading">{{ .grade.scale }}: </span><span>{{ .grade.achieved }}</span> {{ i18n "out_of" }} <span>{{ .grade.outOf }}</span></h6>
                {{ end }}
                {{ if .publications }}
                  <div class="publications">
                    {{/* ... Publications code ... */}}
                  </div>
                {{ end }}


                {{ if .takenCourses }}
                  {{ $pageSize := .takenCourses.collapseAfter | default 5 }}
                  {{ $courses := .takenCourses.courses }}
                  {{ $courseCount := len $courses }}
                  {{ $containerID := printf "courses-pagination-%d" $degreeIndex }}
                  {{ $totalPages := int (math.Ceil (div (float $courseCount) (float $pageSize))) }}

                  <div class="taken-courses" id="{{ $containerID }}">
                    <h6 class="text-heading">{{ i18n "taken_courses" }}:</h6>

                    {{ if .takenCourses.showGrades }}
                      <table>
                        <thead>
                          <th class="course-name-header">{{ i18n "course_name" }}</th>
                          <th>{{ i18n "grade" }}</th>
                        </thead>
                        <tbody>
                          {{ range $index, $course := $courses }}
                            {{ $pageNumber := add 1 (div $index $pageSize) }}
                            <tr class="course-item" data-page="{{ $pageNumber }}" {{ if ne $pageNumber 1 }}style="display: none;"{{ end }}>
                              <td>{{ $course.name }}</td>
                              <td>{{ $course.grade }}</td>
                            </tr>
                          {{ end }}
                        </tbody>
                      </table>
                    {{ else }}
                      <ul>
                        {{ range $index, $course := $courses }}
                          {{ $pageNumber := add 1 (div $index $pageSize) }}
                          <li class="course-item" data-page="{{ $pageNumber }}" {{ if ne $pageNumber 1 }}style="display: none;"{{ end }}>
                            {{ $course.name }}
                          </li>
                        {{ end }}
                      </ul>
                    {{ end }}

                    {{/* --- START: MODIFIED PAGINATION CONTROLS --- */}}
                    {{ if gt $courseCount $pageSize }}
                      <nav aria-label="Course navigation">
                        <ul class="pagination justify-content-center mt-3">
                          {{/* Previous Button */}}
                          <li class="page-item disabled" id="{{ $containerID }}-prev">
                            <a class="page-link" href="#" aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                            </a>
                          </li>
                          {{/* Page Numbers */}}
                          {{ range seq 1 $totalPages }}
                            <li class="page-item page-num-item {{ if eq . 1 }}active{{ end }}">
                              <a class="page-link" href="#" data-page-target="{{ . }}">{{ . }}</a>
                            </li>
                          {{ end }}
                          {{/* Next Button */}}
                          <li class="page-item" id="{{ $containerID }}-next">
                            <a class="page-link" href="#" aria-label="Next">
                              <span aria-hidden="true">&raquo;</span>
                            </a>
                          </li>
                        </ul>
                      </nav>
                    {{ end }}
                    {{/* --- END: MODIFIED PAGINATION CONTROLS --- */}}
                  </div>

                  {{/* --- START: UPDATED JAVASCRIPT --- */}}
                  {{ if gt $courseCount $pageSize }}
                  <script>
                    document.addEventListener('DOMContentLoaded', function () {
                      const container = document.getElementById('{{ $containerID }}');
                      if (!container) return;

                      const courseItems = container.querySelectorAll('.course-item');
                      const pageNumItems = container.querySelectorAll('.page-num-item');
                      const prevButton = document.getElementById('{{ $containerID }}-prev');
                      const nextButton = document.getElementById('{{ $containerID }}-next');
                      
                      const totalPages = {{ $totalPages }};
                      let currentPage = 1;

                      function showPage(pageNumber) {
                        if (pageNumber < 1 || pageNumber > totalPages) {
                          return; // Do nothing if page is out of bounds
                        }
                        currentPage = pageNumber;

                        // Show/hide course items
                        courseItems.forEach(item => {
                          const itemPage = parseInt(item.getAttribute('data-page'));
                          const displayStyle = item.tagName === 'LI' ? 'list-item' : 'table-row';
                          item.style.display = itemPage === currentPage ? displayStyle : 'none';
                        });

                        // Update active state on page numbers
                        pageNumItems.forEach(item => {
                          const itemPage = parseInt(item.querySelector('.page-link').getAttribute('data-page-target'));
                          item.classList.toggle('active', itemPage === currentPage);
                        });

                        // Update Previous/Next buttons
                        prevButton.classList.toggle('disabled', currentPage === 1);
                        nextButton.classList.toggle('disabled', currentPage === totalPages);
                      }

                      // Add listeners to page number links
                      container.querySelectorAll('.page-num-item .page-link').forEach(link => {
                        link.addEventListener('click', function(e) {
                          e.preventDefault();
                          const targetPage = parseInt(this.getAttribute('data-page-target'));
                          showPage(targetPage);
                        });
                      });

                      // Add listener for Previous button
                      prevButton.addEventListener('click', function (e) {
                        e.preventDefault();
                        showPage(currentPage - 1);
                      });

                      // Add listener for Next button
                      nextButton.addEventListener('click', function (e) {
                        e.preventDefault();
                        showPage(currentPage + 1);
                      });
                    });
                  </script>
                  {{ end }}
                  {{/* --- END: UPDATED JAVASCRIPT --- */}}

                {{ end }}

                {{ if .extracurricularActivities }}
                  <div class="extracurricular-activities">
                   {{/* ... Extracurricular Activities code ... */}}
                  </div>
                {{ end }}
                {{ if .customSections }}
                  <div class="custom-section">
                    {{/* ... Custom Sections code ... */}}
                  </div>
                {{ end }}
              </div>
            </td>
          </tr>
        {{ end }}
      </tbody>
    </table>
  </div>
</div>
